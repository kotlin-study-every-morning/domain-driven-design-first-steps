### 04 바운디드 컨텍스트 연동

- 모델의 목적, 즉 경계를 명시하지 않고는 모델을 구축할 수 없다
- 다른 바운디드 컨텍스트의 모델은 서로 독립적으로 발전하고 구현될 수 있다
- 컨트랙트(contract): 바운디드 컨텍스트 사이에 있는 접점

이번 장에서는 바운드 컨텍스트 간의 관계와 연동을 정의하는 도메인 주도 설계 패턴에 대해 배운다

**협력형 패턴 그룹**

1. 파트너십 패턴
    - 바운디드 컨텍스트 간의 연동은 애드혹(ad-hoc / 이것을 위해, 특별한 목적을 위해서) 방식으로 조정
    - 양방향 (일대일?)
    - 양 팀은 함께 해결하고 가장 적절한 솔루션을 선정
    - 성공적인 연동
        - 잘 구축된 협업 실무
        - 높은 수준의 헌신
        - 팀 간의 잦은 동기화
2. 공유 커널 패턴
    - 모든 바운디드 컨텍스트의 필요에 따라 설계
    1. 공유 범위
        - 일관성 유지
        - 수명주기 엮임
        - 변경시 즉시 영향
    2. 구현
        - 컨텍스트의 전용 프로젝트로 떼어내면 라이브러리처럼 바운디드 컨텍스트에서 참조
        - 모든 바운디드 컨텍스트와 연동 테스트를 수행
        - 지속적으로 통합
    3. 공유 커널을 사용해야 하는 경우
        - 중복 비용이 조율 비용보다 클 경우 적용
        - 통합 비용과 중복 비용의 차이는 모델의 변동성(volatility)에 달렸다 ⇒ 변경이 잦을수록 통합 비용은 높아진다
        - 겹치는 형태의 모델인 공유 커널은 사실상 여러 팀이 함께 개발한다 (→ 명분 필요)
        - 공유 커널의 범위를 최소화해 연쇄적인 변경의 범위를 줄이고 매번 변경할 때 마다 통합 테스트를 돌려야 한다

**사용자 - 제공자 패턴 그룹**

사용자 - 제공자 (customer - supplier) 패턴 그룹의 관계

![img_1.png](img_1.png)

1. 순응주의자 패턴
    - 다운스트림 팀이 업스트림 팀의 모델을 받아들이는 바운디드 컨텍스트의 관계
2. 충돌 방지 계층 패턴
    - 충돌 방지 계층을 통해 업스트림 바운디드 컨텍스트의 모델을 스스로의 필요에 맞게 가공
    - 구현?
        - 다운스트림 바운디드 컨텍스트가 하위 도메인을 포함할 경우
            - 핵심 하위 도메인은 각별한 주의가 필요
            - 제공자의 모델이 자칫 문제 도메인에 대한 모델링을 방해할 수 있다
        - 업스트림 모델이 사용자의 요건에 비효율적이거나 불편한 경우
            - 바운디드 컨텍스트가 혼란에 순응하면 그 자체로 위험에 빠짐
            - 레거시 시스템과 연동할 때 종종 발생
        - 제공자가 컨트랙트를 자주 변경하는 경우
            - 사용자는 잦은 변경으로부터 모델을 보호하기 원한다
            - 충돌 방지 계층이 있으면 제공 모델의 변경은 변환 장치에만 영향
3. 오픈 호스트 서비스 패턴
    - 힘이 사용자 측에 있을 경우 처리
    - 제공자는 사용자를 보호하고 가능한 최고의 서비스를 제공하는 데 관심
    - 업스트림 제공자는 퍼블릭 인터페이스와 구현 모델을 분리
    - 외부에 제공되는 퍼블릭 모델과 그 내부 구현을 다른 속도로 발전시킬 수 있음
    - 연동 지향 언어(integration-oriented language) = public protocol = 공표된 언어(published language)
        - 오픈 호스트 서비스(OHS: open-host service) 패턴은 충돌 방지 계층 패턴의 반대
        - 사용자 대신 제공자가 내부 모델 번역을 구현

**분리형 노선**

- 전혀 협력하지 않은 것
1. 커뮤니케이션 이슈
    1. 협업에 어려움을 겪고 있다면 여러 바운디드 컨텍스트 내에서 기능을 중복해서 가져가고 각자의 길을 가는 것이 더 비용 효과적
2. 일반 하위 도메인
    1. 중복된 하위 도메인의 특성도 협업 없이 분리된 길이 가야 하는 이유가 될 수 있다
    2. 여러 컨텍스트 간에 기능 중복이 없을 경우 장점보다 그러한 솔루션을 연동햇을 때 더해지는 복잡성이 더 크다
    3. 기능 중복이 협업보다 비용이 저렴하다
3. 모델의 차이
    1. 모델이 너무 달라서 순응주의자 관계가 불가능하고 충돌 방지 계층을 구현하는 것도 기능 중복보다 비용이 더 클 수 있다

   > 핵심 하위 도메인을 연동할 경우에는 협업 없는 분리형 노선은 피해야 한다


**컨텍스트 맵**

(시스템의 바운디드 컨텍스트 간의 연동 패턴을 분석하여 맵으로 그려낸 것)

- 거시적 설계 관점
    - 컨텍스트 맵은 시스템의 구성 요소와 구현하는 모델의 개요를 제공
- 커뮤니케이션 패턴
    - 컨텍스트 맵은 시스템의 구성요소 간의 커뮤니케이션 패턴을 묘사
- 조직적 문제
    - 컨텍스트 맵은 조직적 문제에 대한 통찰력 제공
1. 유지보수
    1. 컨텍스트 맵은 프로젝트 초기부터 도입해서 새로운 바운디드 컨텍스트와 기존 요소에 대한 수정을 반영하는 것이 이상
    2. 컨텍스트 맵은 컨텍스트 매퍼(Context Mapper [https://contextmapper.org/](https://contextmapper.org/))같은 도구를 사용해서 코드로 관리 할 수 있다
2. 한계
    1. 여러 하위 도메인에 걸친 시스템의 바운디드 컨텍스트에는 작동하는 여러 연동 패턴이 있을 수 있다

**연습 문제**

1. D
2. A
3. A
4. B
