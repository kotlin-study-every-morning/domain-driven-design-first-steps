### 15 이벤트 주도 아키텍처

### 이벤트 주도 아키텍처

이벤트 주도 아키텍처

- 시스템 컴포넌트가 이벤트 메시지를 교환하면서 비동기적으로 서로 커뮤니케이션하는 아키텍처 스타일
- 서비스의 엔드포인트를 동기적으로 호출하는 대신 컴포넌트가 이벤트를 발행해서 시스템 도메인의 변경사항을 다른 시스템 요소에 알려준다
- 해당 컴포넌트는 이벤트 주도 실행 흐름의 일반적인 예는 시가패턴이다

이벤트 주도 아키텍처와 이벤트 소싱의 차이점

- 이벤트 주도 아키텍처
    - 서비스 간 통신을 의미
- 이벤트 소싱
    - 서비스 내부에서 발생
    - 상태의 변화를 일련의 이벤트로 캡처하는 방법

### 이벤트

이벤트 주도 아키텍처 (EDA)

- EDA 시스템에서 이벤트 교환은 구성요소를 연동해서 시스템으로 만들기 위한 핵심 통신 메커니즘
1. 이벤트, 커멘드, 메시지
    - 메시지
        - 이벤트
            - 이미 발생한 변화를 설명하는 메시지
            - 이미 일어난 일
        - 커멘드
            - 수행돼야 할 작업을 설명하는 메시지
            - 어떤 일을 하라는 지시 (날방 origin이 커멘드 느낌인듯)
2. 이벤트 유형
    1. 이벤트 알림
        - 다른 컴포넌트가 반응할 비즈니스 도메인의 변경에 관한 메시지
        - 간결한 이벤트 알림은 여러 시나리오에서 선호
            - ex) 비상사태 경보 : 오후 3시 30분까지 이 지역에 토네이도 경보. 즉시 대피하십시오. 현지 언론 확인 바람.
            - 보안, 동시성
    2. 이벤트를 통한 상태 전송
        - ECST : Event-Carried State Transfer
        - 구독자에게 제공자의 내부 상태에 대한 변경사항을 알려준다
        - ECST 메시지는 상태 변경을 반영하는 모든 데이터를 포함
    3. 도메인 이벤트
        - 6장에서 설명한 도메인 이벤트
        - [06 복잡한 비즈니스 로직 다루기](https://www.notion.so/06-22e300ee29524bbd9d278d35c7be8833)
3. 도메인 이벤트와 이벤트 알림의 관계
    - 도메인 이벤트에는 이벤트를 설명하는 모든 정보를 포함한다
    - 모델링 의도가 다르다
        - 이벤트 알림
            - 다른 컴포넌트와의 연동을 돕기 위해 설계됐다
        - 도메인 이벤트
            - 비즈니스 도메인을 모델링하고 설명하기 위한 것이다
    - 예제

        ```jsx
        eventNatification = {
        	"type": "marriage-recoreded",
        	"persion-id": "asdfa12",
        	"payload": {
        		"person-id": "asdfa12",
        		"details": "/asdfa12/marriage-data"
        	}
        };
        ```

        - 이벤트 알림 메시지 : 결혼했다는 사실 외에 어떠한 정보 포함 X, 자세한 정보는 필드 링크

        ```jsx
        exst = {
        	"type": "personal-details-changed",
        	"persion-id": "asdfa12",
        	"payload": {
        		"new-last-name": "Williams"
        	}
        };
        ```

        - 이벤트를 통한 상태 전송 메시지 : 성이 변경 되었음. 변경된 이유를 설명하지 X

        ```jsx
        domainEvent = {
        	"type": "married",
        	"persion-id": "asdfa12",
        	"payload": {
        		"person-id": "asdfa12",
        		"assumed-partner-last-name": true // -> 정보 포함
        	}
        };
        ```

        - 도메인 이벤트

### 이벤트 주도 연동 설계

소프트웨어 설계는 주로 경계에 관한 것이다. 경계는 내부에 속한 것, 외부에 남아있는 것, 그리고 가장 중요한 것은 경계를 넘어서는 것, 즉 기본적으로 컴포넌트가 서로 연동되는 방식을 정의한다

올바른 유형의 이벤트 메시지를 선택하는 것은 분산 시스템을 제대로 만들거나(느슨한 결합) 망가뜨린다(강한 결합).

1. 이벤트 주도 설계 휴리스틱
    1. 최악의 상황을 가정하라
        - 이벤트 주도 아키텍처에서 ‘주도(driven)’라는 단어는 전체 시스템이 메시지의 성공적인 집단에 달려있음을 의미.
        - 메시지를 안정적으로 발송하기 위해 아웃 박스 패턴을 사용하자
        - 메시지를 방송할 때 구독자가 메시지 중복을 제거하고 순서가 잘못된 메시지를 식별하고 재정렬할 수 있게 하라.
        - 보상 조치를 실행해야 하는 교차 바운디드 컨텍스트 프로세스를 조율할 때 시가 패턴과 프로세스 관리자 패턴을 활용하라
    2. 퍼블릭 이벤트와 프라이빗 이벤트를 사용하라
        1. 이벤트 소싱 애그리게이트에서 도메인 이벤트를 발송할 때 세부 정보를 노출하지 않도록 주의
        2. 이벤트를 바운디드 컨텍스트의 퍼블릭 인터페이스의 내재된 부분으로 취급
        3. 바운디드 컨텍스트의 퍼블릭 인터페이스를 설꼐할 때 다른 유형의 이벤트를 활용
        4. 이벤트를 통한 상태 전송 메시지는 구현 모델을 사용자가 필요로 하는 정보만 전달하는 더욱 간결한 모델로 압축
        5. 외부 바운디드 컨텍스트와 통신을 위한 도메인 이벤트는 최소화하여 사용
    3. 일관성 요구사항을 평가하라
        1. 컴포넌트가 궁극저긍로 일관된 데이터를 처리할 수 있는 경우 이벤트를 통한 상태 전송 메시지 사용
        2. 사용자가 제공자의 마지마긍로 변경된 상태를 읽어야 하는 경우 제공자의 최신 상태를 가져오는 후속 질의와 함께 이벤트 알림 메시지를 발행

### 문제

1. D
2. B
3. A
4. B
